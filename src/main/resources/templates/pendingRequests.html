<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Pending Requests</title>
    <link href="../static/style2.css" th:href="@{/style2.css}" rel="stylesheet" />
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          inherity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJLSAwiGgFAW/dAiS6JXm"
          crossorigin="änonymous">

<body>
<header>
    <h1 class="heading">Εκκρεμείς Αιτήσεις Φοιτητών</h1>
    <div class="row2">
        <div class="row d-flex justify-content-center">
            <div class="table-container">

                <div id="PendingLetters"></div>
                        <table class="table" id="display">
                            <thead>
                            <th>Βαθμός</th>
                            <th>Όνομα φοιτητή</th>
                            <th>Ενέργεια</th>
                            </thead>

                            <tbody id="tbody1">
                            <tr>
                                <td></td>
                                <td></td>
                                <td>
                                    <Button type th:href="@{http://localhost:8080/editRequest/{requestId}}"
                                       class="btn1"> Accept
                                    </Button>
                                    <Button th:href="@{http://localhost:8080/deleteRequest/{requestId}}"
                                       class="btn2"> Reject
                                    </Button>
                                </td>
                            </tbody>
                        </table>
                <div id="searchAllPendingRequestsArea"></div>
                <script>
                    window.addEventListener('load', (event) => {
                        const xhr = new XMLHttpRequest();
                        xhr.open('GET', 'http://localhost:8080/pendingRequests', true);
                        xhr.send();

                        var table = document.getElementById("display");

                        xhr.onreadystatechange = function () {
                            if (xhr.readyState == 4) {
                                if (xhr.status == 200) {

                                    let divElem = document.getElementById('searchAllPendingRequestsArea');
                                    const results = JSON.parse(xhr.responseText);
                                    const item = results[0];
                                    try {
                                        divElem.innerHtml = `${item.mark} ${item.uid} ${item.status}`;
                                        console.log(divElem.innerHtml);
                                    } catch (err) {
                                        alert('You dont have any pending request');
                                        return false;
                                    }


                                    var row = 1;
                                    // const items=results;
                                    //so if its here there is at least on book with that key
                                    results.forEach((item) => {
                                        var display = document.getElementById("display");
                                        var AllNewRow = display.insertRow(row);

                                        var cellA1 = AllNewRow.insertCell(0);
                                        var cellA2 = AllNewRow.insertCell(1);
                                        var cellA3 = AllNewRow.insertCell(2);


                                        cellA1.innerHTML = item.mark;
                                        cellA2.innerHTML = item.uid;
                                        cellA3.innerHTML = item.status;

                                        row++;
                                    });


                                }
                            }


                        }

                    });


                </script>



              </div>
        </div>
    </div>
</div>
</header>
</body>
</html>